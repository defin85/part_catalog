# Armtek API: Сервис Фактур (`/ws_invoice`) - Формализованная информация (на основе реального ответа)

**Примечание:** Эта документация основана на фактическом ответе API, полученном через Postman, и может отличаться от официальной документации на сайте `ws.armtek.ru`.

**Общие параметры:**

*   **Базовый URL:** `http://ws.armtek.ru` (или другой региональный)
*   **Аутентификация:** Basic Authentication (логин/пароль)
*   **Формат ответа:** Управляется query-параметром `format` (`json` или `xml`, по умолчанию `json`).
*   **Базовая структура ответа:**
    *   `STATUS` (integer): HTTP статус код (например, `200`).
    *   `MESSAGES` (array): Массив сообщений (в примере пустой `[]`).
    *   `RESP` (object/array/null): Тело ответа, специфичное для метода.

---

## 1. Метод `getInvoice`

*   **Назначение:** Получение подробной информации по номеру фактуры.
*   **HTTP Метод:** `GET`
*   **Путь:** `/ws_invoice/getInvoice`
*   **Параметры запроса (Query):**
    *   `VKORG` (string, **обязательный**): Сбытовая организация.
    *   `KUNRG` (string, **обязательный**): Номер покупателя (KUNNR\_RG).
    *   `INVOICE` (string, *обязательный, если `ZZSF` пуст*): Номер фактуры (VBELNF).
    *   `ZZSF` (string, *обязательный, если `INVOICE` пуст*): Номер УПД/товчека.
    *   `REFLAG` (integer, *необязательный*): Флаг для получения данных для возврата (значение `1`).
    *   `NOCOLLAPS` (integer, *необязательный*): Флаг разделения по партиям (значение `1`).
    *   `format` (string, *необязательный*): `json` или `xml`.
*   **Структура успешного ответа (`RESP`, object - на основе примера):**
    *   `HEADER` (object): Заголовок фактуры.
        *   `INVOICE` (string): Номер Фактуры (например, `"9022197646"`).
        *   `INVDATE` (string): Дата фактуры (YYYYMMDD, например, `"20250422"`).
        *   `KUNWE` (string): Номер грузополучателя (например, `"0043247459"`).
        *   `KUNZA` (string): Номер адреса доставки (например, `"0043247459"`).
        *   `PARNRZP` (string): Контактное лицо (например, `"0000585586"`).
        *   `NUMDOG` (string): Номер договора (например, `"-"`).
        *   `UPD` (string): Номер УПД (например, `"ХП0071935"`).
        *   `TORG12` (string): Номер ТОРГ12 (в примере пустая строка `""`).
        *   `PAYMENT` (string): Вид оплаты (например, `"безналичный"`).
        *   `INCOTERMS_TXT` (string): Вид доставки (например, `"Доставка"`).
        *   `SUMMA` (string): Общая сумма документа (например, `"3650"`).
        *   `CURRENCY` (string): Валюта документа (например, `"RUB"`).
        *   `ERDAT` (string): Дата и время создания (YYYYMMDDHHMMSS, например, `"20250422041459"`).
        *   `VSTELT` (string): Место отгрузки (например, `"Краснодар"`).
        *   `MAX_RET_SUM` (string): Максимальная сумма возврата (в примере пустая строка `""`).
    *   `ITEMS` (array): Массив позиций фактуры.
        *   `POSNR` (integer): Номер позиции (например, `1`).
        *   `MATNR` (string): Код материала Armtek (например, `"5100354_SX"`).
        *   `PIN` (string): Артикул (например, `"51-00354-SX"`).
        *   `BRAND` (string): Бренд (например, `"STELLOX"`).
        *   `GTD` (string): Номер ГТД (например, `"10317120/160924/5046374"`).
        *   `NAME` (string): Наименование (например, `"наконечник рулевой левый!\\ Mitsubishi Pajero V63/65/Montero 99>"`).
        *   `AMOUNT` (string): Количество (например, `"1"`).
        *   `WEIGHT` (string): Вес брутто позиции (например, `"0.953"`).
        *   `VOLUM` (string): Объем позиции (например, `"1.98"`).
        *   `SUMMA` (string): Сумма по позиции без НДС (например, `"960"`).
        *   `PRICE` (string): Цена за единицу без НДС (например, `"960"`).
        *   `RETMG` (string): Доступное количество для возврата (например, `"0"`).
        *   `NORET` (string): Признак невозможности возврата (в примере пустая строка `""`).
        *   `MINBM` (string): Минимальное количество для заказа (например, `"1"`).
        *   `RDPRF` (string): Кратность (например, `"1"`).
        *   `SCAL` (string): Шкала цен (в примере пустая строка `""`).
        *   `DRE` (string): Срок возврата в днях (например, `"30"`).
        *   `ORDER` (string): Номер заказа Armtek (например, `"459793659"`).
        *   `ORDER_POS` (string): Номер позиции в заказе Armtek (например, `"10"`).
        *   `ORDER_NOTE` (string): Комментарий к позиции заказа (например, `"mitsu l200"`).
        *   `COUNTRY` (string): Страна происхождения (например, `"(TR, 792) Турция"`).
        *   `VatRate` (string): Ставка НДС (например, `"20.00"`).
        *   `VatAmount` (string): Сумма НДС по позиции (например, `"160.00"`).
        *   `Ean` (string): Штрих-код EAN (например, `"4057276185203"`).
        *   `Tnved` (string): Код ТН ВЭД (например, `"8708949909"`).
    *   `CASH` (string): Способы возврата денег (в примере пустая строка `""`, вероятно, появляется при `REFLAG=1`).
    *   `AUGRU_OUTPUT` (string): Причины возврата (в примере пустая строка `""`, вероятно, появляется при `REFLAG=1`).

---

## 2. Метод `createReturnInvoice`

*   **Назначение:** Создание возврата по фактуре.
*   **HTTP Метод:** `POST`
*   **Путь:** `/ws_invoice/createReturnInvoice`
*   **Параметры запроса (Body - JSON или form-urlencoded):**
    *   `VKORG` (string, **обязательный**): Сбытовая организация (из `getInvoice`).
    *   `KUNRG` (string, **обязательный**): Покупатель (из `getInvoice`).
    *   `VBELNF` (string, **обязательный**): Номер фактуры (из `getInvoice`, поле `INVOICE` в JSON).
    *   `AUGRU` (string, **обязательный**): Код причины возврата (из `getInvoice`, поле `AUGRU_OUTPUT` при `REFLAG=1`).
    *   `RESOLUTION` (string, *необязательный*): Описание причины возврата (текст).
    *   `CASH_BACK` (string, *необязательный*): Код способа возврата денег (из `getInvoice`, поле `CASH` при `REFLAG=1`).
    *   `KUNWE` (string, *необязательный*): Грузополучатель (из `getInvoice`, поле `KUNWE` в JSON).
    *   `KUNNR_ZA` / `KUNZA` (string, *необязательный*): Адрес доставки/Пункт выдачи (из `getInvoice`, поле `KUNZA` в JSON).
    *   `INVDATE` (string, *необязательный*): Дата возврата (формат `YYYYMMDD`).
    *   `PARNRZP` (string, *необязательный*): Контактное лицо (из `getInvoice`, поле `PARNRZP` в JSON).
    *   `POSITION_INPUT` (array, **обязательный**): Массив объектов с позициями для возврата.
        *   `POSNR` (string/integer, **обязательный**): Номер позиции из фактуры (из `getInvoice`, поле `POSNR` в JSON).
        *   `MATNR` (string, **обязательный**): Код материала из фактуры (из `getInvoice`, поле `MATNR` в JSON).
        *   `VRKME` (string, **обязательный**): Единица измерения из фактуры (отсутствует в примере JSON, брать из документации или уточнять).
        *   `KWMENG` (number/string, **обязательный**): Количество возвращаемого материала (не должно превышать `RETMG` из `getInvoice`).
*   **Структура успешного ответа (`RESP`, object):**
    *   `VBELNR` (string): Номер созданного документа возврата.

---