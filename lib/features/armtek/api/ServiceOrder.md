# Armtek API: Сервис Заказов (`/ws_order`) - Формализованная информация

**Общие параметры:**

*   **Базовый URL:** `http://ws.armtek.ru` (или другой региональный)
*   **Аутентификация:** Basic Authentication (логин/пароль)
*   **Формат ответа:** Управляется query-параметром `format` (`json` или `xml`, по умолчанию `json`).
*   **Базовая структура ответа:**
    *   `STATUS` (integer): HTTP статус код.
    *   `MESSAGES` (array): Массив сообщений (`TYPE`, `TEXT`, `DATE`).
    *   `RESP` (object/array/null): Тело ответа, специфичное для метода.

---

## 1. Метод `createOrder`

*   **Назначение:** Создание нового заказа.
*   **HTTP Метод:** `POST`
*   **Путь:** `/ws_order/createOrder`
*   **Параметры запроса (Body - JSON или form-urlencoded):**
    *   `VKORG` (string, **обязательный**): Сбытовая организация.
    *   `KUNRG` (string, **обязательный**): Номер покупателя (KUNNR\_RG).
    *   `KUNWE` (string, *необязательный*): Номер грузополучателя (KUNNR\_WE).
    *   `KONDA` (string, *необязательный*): Ценовая группа клиента.
    *   `BSTKD` (string, *необязательный*): Номер заказа клиента.
    *   `KETDT` (string, *необязательный*): Желаемая дата поставки (формат `YYYYMMDD`).
    *   `INCOTERMS` (string, *необязательный*): Признак самовывоза (`1` - самовывоз, `0` или пусто - доставка).
    *   `DELIVERY_ADDRESS` (string, *необязательный*): Адрес доставки (текст).
    *   `DELIVERY_INTERVAL` (string, *необязательный*): Интервал доставки (текст).
    *   `DELIVERY_METHOD` (string, *необязательный*): Способ доставки (текст).
    *   `CONTACT_PERSON` (string, *необязательный*): Контактное лицо (текст).
    *   `CONTACT_PHONE` (string, *необязательный*): Телефон контактного лица (текст).
    *   `BACKORDER` (string, *необязательный*): Признак разрешения довоза (`1` - разрешен, `0` или пусто - запрещен).
    *   `SUBSTITUTION` (string, *необязательный*): Признак разрешения замен (`1` - разрешен, `0` или пусто - запрещен).
    *   `CHECK_LEVEL` (integer, *необязательный*, по умолчанию `1`): Уровень проверки остатков (`1` - только основной склад, `2` - все склады Armtek, `3` - все склады Armtek + партнеры).
    *   `ITEMS` (array, **обязательный**): Массив объектов с позициями заказа.
        *   `PIN` (string, **обязательный**): Артикул.
        *   `BRAND` (string, **обязательный**): Наименование бренда.
        *   `KEYZAK` (string, *необязательный*): Код склада Armtek (из ответа сервиса поиска). **Рекомендуется заполнять.**
        *   `KWMENG` (number/string, **обязательный**): Количество.
        *   `PRICEMAX` (string, *необязательный*): Максимальная цена.
        *   `DATEMAX` (string, *необязательный*): Максимальная дата поставки (формат `YYYYMMDD`).
        *   `NOTE` (string, *необязательный*): Комментарий к позиции.
        *   `ARTSKU` (string, *необязательный*): Код материала Armtek (MATNR).
        *   `NAME` (string, *необязательный*): Наименование товара.
*   **Структура успешного ответа (`RESP`, object):**
    *   `ORDER` (string): Номер созданного заказа Armtek.

---

## 2. Метод `createTestOrder`

*   **Назначение:** Создание тестового заказа (без реального размещения).
*   **HTTP Метод:** `POST`
*   **Путь:** `/ws_order/createTestOrder`
*   **Параметры запроса (Body - JSON или form-urlencoded):** Аналогичны `createOrder`.
*   **Структура успешного ответа (`RESP`, object):**
    *   `ORDER` (string): Номер созданного тестового заказа Armtek.

---

## 3. Метод `getOrder`

*   **Назначение:** Получение подробной информации по номеру заказа.
*   **HTTP Метод:** `GET`
*   **Путь:** `/ws_order/getOrder`
*   **Параметры запроса (Query):**
    *   `VKORG` (string, **обязательный**): Сбытовая организация.
    *   `KUNRG` (string, **обязательный**): Номер покупателя (KUNNR\_RG).
    *   `ORDER` (string, **обязательный**): Номер заказа Armtek.
    *   `format` (string, *необязательный*): `json` или `xml`.
*   **Структура успешного ответа (`RESP`, object):**
    *   `HEADER` (object): Заголовок заказа.
        *   `ORDER` (string): Номер заказа Armtek.
        *   `ORDER_DATE` (string): Дата создания заказа (YYYYMMDD).
        *   `ORDER_TIME` (string): Время создания заказа (HHMMSS).
        *   `ORDER_TYPE` (string): Тип заказа (например, "Отгрузка с ОСНОВНЫХ складов АРМТЕК").
        *   `ORDER_STATUS` (string): Статус заказа (например, "Создан", "В работе", "Закрыт", "Отклонен").
        *   `KUNRG` (string): Номер покупателя.
        *   `KUNRG_TXT` (string): Наименование покупателя.
        *   `KUNWE` (string): Номер грузополучателя.
        *   `KUNWE_TXT` (string): Наименование грузополучателя.
        *   `KUNNR_ZA` (string): Номер адреса доставки/пункта выдачи.
        *   `ADDRZA` (string): Адрес доставки (текст).
        *   `PARNRAP` (string): Код создателя заказа.
        *   `NAMEAP` (string): Наименование создателя заказа.
        *   `BSTKD` (string): Номер заказа клиента.
        *   `KETDT` (string): Желаемая дата поставки (YYYYMMDD).
        *   `INCOTERMS` (string): Признак самовывоза (`1` или `0`).
        *   `DELIVERY_ADDRESS` (string): Адрес доставки (текст).
        *   `DELIVERY_INTERVAL` (string): Интервал доставки (текст).
        *   `DELIVERY_METHOD` (string): Способ доставки (текст).
        *   `CONTACT_PERSON` (string): Контактное лицо (текст).
        *   `CONTACT_PHONE` (string): Телефон контактного лица (текст).
        *   `BACKORDER` (string): Признак разрешения довоза (`1` или `0`).
        *   `SUBSTITUTION` (string): Признак разрешения замен (`1` или `0`).
        *   `SUMMA` (number/string): Общая сумма заказа.
        *   `CURRENCY` (string): Валюта заказа.
    *   `ITEMS` (array): Массив позиций заказа.
        *   `POSNR` (string): Номер позиции.
        *   `PIN` (string): Артикул.
        *   `BRAND` (string): Бренд.
        *   `NAME` (string): Наименование.
        *   `KWMENG` (number/string): Количество заказанное.
        *   `KWMENG_CONF` (number/string): Количество подтвержденное.
        *   `PRICE` (number/string): Цена за единицу.
        *   `SUMMA` (number/string): Сумма по позиции.
        *   `NOTE` (string): Комментарий к позиции.
        *   `STATUS` (string): Статус позиции.
        *   `STATUS_DATE` (string): Дата статуса позиции (YYYYMMDD).
        *   `STATUS_TIME` (string): Время статуса позиции (HHMMSS).
        *   `DELIVERY_DATE` (string): Ожидаемая дата поставки (YYYYMMDD).
        *   `DELIVERY_TIME` (string): Ожидаемое время поставки (HHMMSS).
        *   `KEYZAK` (string): Код склада Armtek.
        *   `ARTSKU` (string): Код материала Armtek (MATNR).
        *   `PRICEMAX` (string): Максимальная цена.
        *   `DATEMAX` (string): Максимальная дата поставки (YYYYMMDD).
        *   `VBELN` (string): Номер документа отгрузки (если есть).
        *   `POSNR_VL` (string): Номер позиции в документе отгрузки.
        *   `VBELN_VF` (string): Номер документа фактуры (если есть).
        *   `POSNR_VF` (string): Номер позиции в документе фактуры.
        *   `ABGRU` (string): Причина отказа.
        *   `ABGRU_TXT` (string): Описание причины отказа.

---

## 4. Метод `getOrder2`

*   **Назначение:** Получение подробной информации по номеру заказа (версия 2, с расшифровкой статусов).
*   **HTTP Метод:** `GET`
*   **Путь:** `/ws_order/getOrder2`
*   **Параметры запроса (Query):**
    *   `VKORG` (string, **обязательный**): Сбытовая организация.
    *   `KUNRG` (string, **обязательный**): Номер покупателя (KUNNR\_RG).
    *   `ORDER` (string, **обязательный**): Номер заказа Armtek.
    *   `STATUS` (integer, *необязательный*): Флаг получения расшифровки статусов (`1` - получать).
    *   `format` (string, *необязательный*): `json` или `xml`.
*   **Структура успешного ответа (`RESP`, object):** Аналогична `getOrder`, но дополнительно содержит:
    *   `STATUSES` (array, *только если `STATUS=1`*): Массив объектов с расшифровкой статусов позиций.
        *   `POSNR` (string): Номер позиции.
        *   `STATUS` (string): Код статуса.
        *   `STATUS_DATE` (string): Дата статуса (YYYYMMDD).
        *   `STATUS_TIME` (string): Время статуса (HHMMSS).
        *   `STATUS_TXT` (string): Описание статуса.
        *   `KWMENG` (number/string): Количество в этом статусе.
    *   `ABGRU_ITEMS` (array): Массив объектов с расшифровкой причин отказа.
        *   `ABGRU` (string): Код причины отказа.
        *   `TEXT` (string): Описание причины отказа.

---

## 5. Метод `getRefund`

*   **Назначение:** Получение подробной информации по номеру возврата.
*   **HTTP Метод:** `GET`
*   **Путь:** `/ws_order/getRefund`
*   **Параметры запроса (Query):**
    *   `VKORG` (string, **обязательный**): Сбытовая организация.
    *   `KUNRG` (string, **обязательный**): Номер покупателя (KUNNR\_RG).
    *   `RETURN` (string, **обязательный**): Номер документа возврата.
    *   `format` (string, *необязательный*): `json` или `xml`.
*   **Структура успешного ответа (`RESP`, object):** Аналогична `getOrder`, но специфична для документа возврата (требует уточнения структуры по реальному ответу или более детальной документации).

---

## 6. Метод `editOrder`

*   **Назначение:** Редактирование существующего заказа (изменение количества, отмена позиций).
*   **HTTP Метод:** `POST`
*   **Путь:** `/ws_order/editOrder`
*   **Параметры запроса (Body - JSON или form-urlencoded):**
    *   `VKORG` (string, **обязательный**): Сбытовая организация.
    *   `KUNRG` (string, **обязательный**): Номер покупателя (KUNNR\_RG).
    *   `ORDER` (string, **обязательный**): Номер заказа Armtek для редактирования.
    *   `ITEMS` (array, **обязательный**): Массив объектов с позициями для редактирования.
        *   `POSNR` (string, **обязательный**): Номер позиции в заказе.
        *   `KWMENG` (number/string, **обязательный**): Новое количество. Если `0`, позиция отменяется.
        *   `ABGRU` (string, *необязательный*): Код причины отказа (обязателен при `KWMENG=0`). Коды берутся из `getOrder2` -> `ABGRU_ITEMS`.
        *   `NOTE` (string, *необязательный*): Комментарий к изменению.
*   **Структура успешного ответа (`RESP`, object):**
    *   `ORDER` (string): Номер отредактированного заказа Armtek (обычно тот же, что и в запросе).

---