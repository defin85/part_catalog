# Стратегия и паттерны тестирования

> Этот документ описывает подходы к тестированию в проекте Part Catalog, включая стратегию, инструменты и рекомендуемые паттерны.

## Содержание
- [Обзор стратегии тестирования](#обзор-стратегии-тестирования)
- [Уровни тестирования](#уровни-тестирования)
- [Unit-тестирование](#unit-тестирование)
- [Widget-тестирование](#widget-тестирование)
- [Интеграционное тестирование](#интеграционное-тестирование)
- [Моки и стабы](#моки-и-стабы)
- [Структура тестового проекта](#структура-тестового-проекта)
- [Непрерывная интеграция](#непрерывная-интеграция)
- [Рекомендации и лучшие практики](#рекомендации-и-лучшие-практики)

## Обзор стратегии тестирования

Проект Part Catalog использует многоуровневый подход к тестированию, следуя принципу пирамиды тестирования:

```
▲  Меньше
│
│    E2E тесты
│    Интеграционные тесты
│    Widget тесты
│    Unit тесты
│
▼  Больше
```

Этот подход обеспечивает:
* Раннее обнаружение ошибок
* Эффективную отладку благодаря локализации проблем
* Снижение стоимости исправления ошибок
* Быстрое выполнение тестовых наборов

## Уровни тестирования

### 1. Unit-тестирование

Фокус: Отдельные компоненты и функции
Объем: ~70% всех тестов
Инструменты: flutter_test, mockito, mocktail

### 2. Widget-тестирование

Фокус: UI-компоненты и взаимодействие пользователя
Объем: ~20% всех тестов
Инструменты: flutter_test с виджет-тестами

### 3. Интеграционное тестирование

Фокус: Взаимодействие между различными частями приложения
Объем: ~10% всех тестов
Инструменты: integration_test

### 4. E2E-тестирование

Фокус: Полноценные пользовательские сценарии
Объем: Ограниченное количество ключевых сценариев
Инструменты: flutter_driver

## Unit-тестирование

### Подход

Для модульного тестирования используется метод AAA (Arrange-Act-Assert):

1. Arrange: Подготовка данных, создание моков и настройка тестового окружения
2. Act: Вызов тестируемой функциональности
3. Assert: Проверка результатов и побочных эффектов

### Инструменты

flutter_test: Основной фреймворк для тестирования Dart/Flutter
mockito/mocktail: Библиотеки для создания моков
fake_async: Для тестирования асинхронного кода с виртуальным временем

### Тестирование асинхронного кода

Для асинхронного кода используем:

* async/await в тестах с асинхронными операциями
* fakeAsync для тестирования кода с таймерами
* pumpAndSettle для ожидания завершения анимаций в виджет-тестах

## Widget-тестирование

### Подход

Widget-тесты проверяют:

* Корректное отображение UI-компонентов
* Обработку пользовательских взаимодействий
* Правильное отображение данных
* Обработку различных состояний (загрузка, ошибка, пустые данные)

### Инструменты

* WidgetTester: API для взаимодействия с виджетами
* Finder: Поиск виджетов в дереве
* GoldenFileComparator: Сравнение с эталонными снимками виджетов

### Golden-тестирование

Golden-тесты создают скриншоты виджетов для визуального сравнения

## Интеграционное тестирование

### Подход

Интеграционные тесты проверяют взаимодействие между различными частями приложения:

* Интеграцию между экранами
* Потоки данных между слоями
* Взаимодействие с внешними зависимостями (при необходимости с их моками)

### Инструменты

integration_test: Фреймворк для интеграционного тестирования
flutter_driver: Управление приложением для E2E тестов

## Моки и стабы

### Определения

* Мок (Mock): Имитирует объект и отслеживает вызовы его методов
* Стаб (Stub): Возвращает предопределенный результат без отслеживания
* Фейк (Fake): Предоставляет упрощенную реализацию функциональности

### Создание моков с Mocktail
### Создание моков с Mocktail
### Ручные моки

## Структура тестового проекта

### Организация тестов

```
test/
  ├─ unit/                       # Модульные тесты
  │   ├─ features/
  │   │   ├─ clients/
  │   │   │   ├─ services/
  │   │   │   │   └─ client_service_test.dart
  │   │   │   └─ repositories/
  │   │   │       └─ client_repository_test.dart
  │   │   └─ vehicles/
  │   └─ core/
  │       ├─ utils/
  │       └─ database/
  │
  ├─ widget/                     # Тесты виджетов
  │   ├─ features/
  │   │   ├─ clients/
  │   │   │   └─ screens/
  │   │   │       └─ client_list_screen_test.dart
  │   │   └─ vehicles/
  │   └─ shared/
  │       └─ widgets/
  │
  ├─ integration/                # Интеграционные тесты
  │   ├─ clients_flow_test.dart
  │   └─ vehicles_flow_test.dart
  │
  └─ mocks/                      # Общие моки для тестов
      ├─ mock_client_repository.dart
      └─ mock_service_locator.dart

integration_test/                # Тесты для интеграции с устройствами
  ├─ app_test.dart
  └─ driver.dart
```

### Общие моки и тестовые данные

## Непрерывная интеграция

### GitHub Actions

### Автоматизация тестов

Pre-commit хуки: flutter analyze и flutter test перед коммитом
CI/CD: Автоматический запуск тестов при пуше и пулл-реквестах
Отчеты о покрытии: Интеграция с сервисами анализа кода (Codecov, SonarQube)

## Рекомендации и лучшие практики

### Основные рекомендации

Изоляция тестов: Каждый тест должен быть независимым от других
Детерминированность: Тесты должны давать одинаковый результат при многократном запуске
Быстрое выполнение: Модульные тесты должны выполняться быстро
Тестирование граничных условий: Проверяйте крайние случаи и исключения
Поддержание тестов в актуальном состоянии: Обновляйте тесты при изменении кода

### Паттерн AAA (Arrange-Act-Assert)

Структурируйте тесты по паттерну AAA для повышения читаемости

### BDD стиль с описательными именами тестов

### Использование фикстур и setUp/tearDown

### Проверка покрытия кода тестами

Запуск тестов с генерацией отчета о покрытии
Конвертация отчета в HTML для удобного просмотра (требуется lcov)