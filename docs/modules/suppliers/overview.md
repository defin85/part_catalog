# Модуль поставщиков запчастей

> Этот модуль отвечает за интеграцию с API поставщиков запчастей для получения информации о ценах и сроках доставки.

## Содержание

- [Назначение](#назначение)
- [Архитектура](#архитектура)
- [Ключевые компоненты](#ключевые-компоненты)
- [Режимы работы](#режимы-работы)
- [Интеграция с прокси-сервером](#интеграция-с-прокси-сервером)

## Назначение

Модуль поставщиков решает следующие задачи:

- Получение актуальных цен на запчасти от разных поставщиков
- Поиск запчастей по артикулу у разных поставщиков
- Получение информации о сроках доставки
- Агрегация данных от разных поставщиков в единый формат

## Архитектура

Модуль построен на принципах **Чистой архитектуры** с четким разделением на уровни:

| Уровень | Назначение | Компоненты |
|---------|------------|------------|
| Presentation | Отображение данных | `SupplierScreen`, `PriceListWidget` |
| Domain | Бизнес-логика | `SuppliersService`, `SupplierRepository` |
| Data | Источники данных | `SupplierApiClient`, `LocalCacheManager` |

### Диаграмма компонентов

### Диаграмма компонентов

```
┌───────────────┐       ┌──────────────────┐      ┌─────────────────┐
│ ApiConnection │       │                  │      │                 │
│     Mode      │────>  │ ApiClientManager │────> │SupplierApiClient│
└───────────────┘       └──────────────────┘      └─────────────────┘
                                │                          │
                                │                          │
                                ▼                          │
                        ┌───────────────┐                  │
                        │ LocalStorage  │ <────────────────┘
                        │   Manager     │
                        └───────────────┘
```

## Ключевые компоненты

### SupplierApiClient

Базовый интерфейс для всех клиентов API поставщиков:

```dart
abstract class SupplierApiClient {
  Future<List<PartPriceModel>> getPricesByArticle(String article);
  Future<List<PartInfoModel>> searchPartsByName(String name);
  Future<PartDetailModel?> getPartDetails(String articleNumber);
}
```

### SuppliersService

Сервис для работы с API поставщиков:

```dart
class SuppliersService {
  final Map<String, SupplierApiClient> _clients;

  SuppliersService(this._clients);

  Future<Map<String, List<PartPriceModel>>> getAllPricesByArticle(String article) async {
    // Реализация
  }
  
  Future<List<PartPriceModel>> getBestPricesByArticle(String article) async {
    // Реализация
  }
}
```

### Режимы работы

Модуль поддерживает 3 режима работы с API поставщиков:

|   Режим   |   Описание                    |	Применение  |
|-----------|-------------------------------|---------------|
| Direct    | Прямое подключение к API      | Автономная работа, разработка, тестирование, локальная разработка    |
| Proxy     | Через прокси-сервер           | Продакшен, ограничения безопасности, платные API    |
|   Hybrid |	Автоматическое переключение |   Повышенная отказоустойчивость           |

**Подробнее о каждом режиме:**

    *   Прямое подключение к API
    *   Использование прокси-сервера
    *   Автоматическое переключение между режимами

### Интеграция с прокси-сервером

Для перехода на работу через прокси-сервер необходима минимальная модификация кода клиента:

    1. Настройка режима работы в AppConfig
    2. Использование ApiClientManager для создания подходящих клиентов API
    3. Настройка адреса прокси-сервера

Подробнее см. [Реализация прокси-сервера](proxy_server.md).
