# Прокси-сервер для API поставщиков

> Прокси-сервер позволяет централизовать доступ к API поставщиков запчастей, обеспечивая безопасное хранение API-ключей, кэширование результатов и оптимизацию платных запросов.

## Содержание

- Назначение
- Архитектура
- Ключевые компоненты
- Установка и запуск
- Интеграция с клиентом

## Назначение

Прокси-сервер решает следующие задачи:

- Централизованное хранение API-ключей поставщиков
- Обеспечение доступа к API с фиксированных IP-адресов
- Кэширование результатов для оптимизации платных запросов
- Унификация формата данных от разных поставщиков
- Мониторинг и логирование запросов

## Архитектура

Прокси-сервер разработан на Dart с использованием пакета `shelf` и переиспользует код клиентской части для работы с API поставщиков.

### Технический стек

- **Язык**: Dart
- **Фреймворк**: shelf
- **Хранение кэша**: sembast
- **Логирование**: logging

### Общая схема работы

```
┌──────────────┐      HTTP      ┌──────────────┐      HTTP       ┌─────────────┐
│    Клиент    │   запрос 1 ─▶  │ Прокси-сервер│   запрос     ─▶│   API       │
│  (Flutter)   │                │ (Dart)        │                │ Поставщика  │
└──────────────┘  ◀──────────   └──────────────┘  ◀──────────   └─────────────┘
                       ответ                      ответ
         │
         ▼
    ┌───────────────┐
    │      Кэш      │
    │(sembast/redis)│
    └───────────────┘
```

## Ключевые компоненты

### Основные компоненты сервера

- **Router**: маршрутизация HTTP-запросов
- **ApiClientManager**: управление клиентами API поставщиков
- **CacheManager**: кэширование результатов запросов

### Основные эндпоинты API

| Метод | Путь | Описание |
|-------|------|----------|
| GET | `/api/suppliers/{supplier}/prices` | Получение цен от конкретного поставщика |
| GET | `/api/suppliers/{supplier}/search` | Поиск запчастей у конкретного поставщика |
| GET | `/api/prices` | Агрегация цен от всех поставщиков |
| GET | `/health` | Проверка работоспособности сервера |

## Установка и запуск

### Предварительные требования

- Dart SDK 2.17.0 или выше
- Настроенные переменные окружения с API-ключами поставщиков

### Команда запуска

```bash
# Запуск с параметрами по умолчанию
dart bin/server.dart

# Запуск с указанием порта
dart bin/server.dart --port=8080
```

## Интеграция с клиентом

Для подключения клиента Flutter к прокси-серверу:

Настройка режима API в конфигурации:

```dart
// Изменение режима API на proxy
await apiClientManager.switchMode(ApiConnectionMode.proxy);
```

Указание URL прокси-сервера:

```dart
// Сохранение URL прокси-сервера
final prefs = await SharedPreferences.getInstance();
await prefs.setString('proxy_server_url', 'https://your-proxy-server.com');
```

