# Модуль автомобилей

> Модуль автомобилей обеспечивает управление информацией об автомобилях клиентов СТО, включая их характеристики и связь с владельцами.

## Содержание
- [Назначение](#назначение)
- [Архитектура](#архитектура)
- [Основные компоненты](#основные-компоненты)
- [Модели данных](#модели-данных)
- [Основные операции](#основные-операции)
- [UI компоненты](#ui-компоненты)
- [Адаптивный интерфейс](#адаптивный-интерфейс)
- [Типичные сценарии использования](#типичные-сценарии-использования)

## Назначение

Модуль автомобилей решает следующие задачи:
- Учет автомобилей клиентов СТО
- Хранение технических характеристик автомобилей (марка, модель, VIN-код)
- Связь автомобилей с их владельцами (клиентами)
- Предоставление интерфейса для создания, редактирования и удаления автомобилей

## Архитектура

Модуль следует принципам чистой архитектуры и состоит из следующих уровней:

|   Уровень       | Назначение                    | Компоненты                    |
|-----------------|-------------------------------|-------------------------------|
|   Presentation  | Пользовательский интерфейс    | CarsScreen, CarFormDialog     |
|   Domain        | Бизнес-логика                 | CarService                    |
|   Data          | Доступ к данным               | CarsDao, CarsItemsCompanion   |

## Основные компоненты

### CarService

Сервисный класс для работы с автомобилями. Основные методы:

- **getCars()** - Получение списка всех автомобилей
- **watchCarsWithOwners()** - Реактивное наблюдение за автомобилями с информацией о владельцах
- **getCarById(int id)** - Получение автомобиля по ID
- **addCar(CarModel car)** - Добавление нового автомобиля
- **updateCar(CarModel car)** - Обновление данных автомобиля
- **deleteCar(int carId)** - Удаление автомобиля
- **getCarsByClientId(int clientId)** - Получение автомобилей конкретного клиента

### CarsDao

Data Access Object для прямого взаимодействия с таблицей автомобилей в базе данных:

- **getActiveCars()** - Получение всех неудаленных автомобилей
- **watchCarsWithOwners()** - Реактивное наблюдение за связкой автомобиль-владелец
- **getCarById(int id)** - Получение записи автомобиля по ID
- **insertCar(CarsItemsCompanion car)** - Вставка нового автомобиля
- **updateCar(CarsItemsCompanion car)** - Обновление информации об автомобиле
- **softDeleteCar(int carId)** - Мягкое удаление автомобиля
- **softDeleteCarsByClientId(int clientId)** - Удаление всех автомобилей клиента

## Модели данных

CarsItem (модель таблицы)

```dart
class CarsItems extends Table {
  IntColumn get id => integer().autoIncrement()();
  IntColumn get clientId => integer().references(ClientsItems, #id)();
  TextColumn get make => text()();
  TextColumn get model => text()();
  IntColumn get year => integer().nullable()();
  TextColumn get vin => text().nullable()();
  TextColumn get licensePlate => text().nullable()();
  TextColumn get additionalInfo => text().nullable()();
  DateTimeColumn get deletedAt => dateTime().nullable()();
}
```

CarModel (бизнес-модель)

Представляет автомобиль в бизнес-логике приложения:

**id**: Уникальный идентификатор
**clientId**: ID клиента-владельца
**make**: Марка автомобиля
**model**: Модель автомобиля
**year**: Год выпуска
**vin**: VIN-код
**licensePlate**: Государственный номер
**additionalInfo**: Дополнительная информация

CarWithOwnerModel (расширенная бизнес-модель)

Объединяет данные об автомобиле с информацией о владельце:

car: Основная модель автомобиля
ownerName: Имя владельца
ownerType: Тип клиента-владельца


## Основные операции

Отображение списка автомобилей с владельцами

Реализация через реактивные потоки данных для автоматического обновления UI при изменениях:

```dart
StreamBuilder<List<CarWithOwnerModel>>(
  stream: _carService.watchCarsWithOwners(),
  builder: (context, snapshot) {
    // Логика построения UI на основе данных
  }
)
```

Добавление/редактирование автомобиля
Процесс включает:

Выбор клиента из списка
Ввод характеристик автомобиля
Валидация данных (обязательные поля, уникальность VIN)
Сохранение в базе данных
Связь с другими модулями
Клиенты: Каждый автомобиль привязан к клиенту
Заказ-наряды: Автомобиль является объектом работ в заказ-нарядах
Каталог запчастей: Поиск запчастей для конкретного автомобиля

## UI компоненты

CarsScreen
Основной экран управления автомобилями:

Список автомобилей с информацией о владельцах
Поиск по марке, модели, VIN или госномеру
Кнопка добавления нового автомобиля
Возможность редактирования и удаления автомобилей
Фильтрация по владельцу

CarFormDialog
Форма для добавления/редактирования автомобиля:

Поля для ввода характеристик автомобиля
Выпадающий список для выбора владельца
Валидация обязательных полей
Проверка уникальности VIN-кода и госномера

CarDetailsScreen
Экран детальной информации об автомобиле:

Полная информация о характеристиках
История заказ-нарядов для данного автомобиля
Возможность редактирования и удаления

## Адаптивный интерфейс

Для эффективной работы на разных устройствах реализован адаптивный интерфейс:

Мобильные устройства: Список с карточками автомобилей и отдельные экраны для деталей
Десктопные платформы: Таблица с сортировкой и фильтрацией, редактирование в боковой панели
Планшеты: Комбинация мобильного и десктопного интерфейса
Все компоненты адаптированы для разных размеров экранов и ориентаций.

## Типичные сценарии использования

1. Регистрация нового автомобиля клиента
Поиск или создание клиента
Заполнение данных автомобиля
Сохранение связи автомобиль-клиент

2. Поиск автомобиля по VIN или госномеру
Быстрый поиск с автодополнением
Отображение детальной информации

3. Привязка автомобиля к новому владельцу
Изменение поля clientId
Обновление связанных данных

4. Просмотр истории заказ-нарядов
На экране детальной информации автомобиля
Быстрый переход к заказ-нарядам