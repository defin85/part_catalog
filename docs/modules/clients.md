# Модуль клиентов

> Модуль клиентов обеспечивает управление информацией о клиентах СТО, включая физические и юридические лица.

## Содержание
- [Назначение](#назначение)
- [Архитектура](#архитектура)
- [Основные компоненты](#основные-компоненты)
- [Модели данных](#модели-данных)
- [Основные операции](#основные-операции)
- [UI компоненты](#ui-компоненты)

## Назначение

Модуль клиентов решает следующие задачи:
- Учет физических и юридических лиц, являющихся клиентами СТО
- Хранение и управление контактными данными клиентов
- Связь клиентов с их автомобилями и заказ-нарядами
- Предоставление интерфейса для создания, редактирования и удаления клиентов

## Архитектура

Модуль следует принципам чистой архитектуры и состоит из следующих уровней:

| Уровень | Назначение | Компоненты |
|---------|------------|------------|
| Presentation | Пользовательский интерфейс | `ClientsScreen`, `ClientDialog` |
| Domain | Бизнес-логика | `ClientService`, `ClientModelComposite`, `IClientEntity` (если нужен специфичный интерфейс) |
| Data | Доступ к данным | `ClientsDao`, `ClientsItemsCompanion`, `ClientData` (`@freezed`) |


## Основные компоненты

### ClientService

Сервисный класс, обеспечивающий бизнес-логику работы с клиентами:

Функциональность: Преобразует данные между моделями БД (`ClientsItem`), моделями данных (`ClientData`, `EntityCoreData`) и бизнес-моделями (`ClientModelComposite`). Работает с интерфейсами (`IClientEntity`).
Ключевые методы:
- **getClients()**: Получение списка `ClientModelComposite`.
- **watchClients()**: Реактивное наблюдение за списком `ClientModelComposite`.
- **addClient(ClientModelComposite client)**: Добавление нового клиента.
- **updateClient(ClientModelComposite client)**: Обновление существующего клиента.
- **deleteClient(String clientUuid)**: Мягкое удаление клиента.
- **searchClientsByName()**: Поиск клиентов по имени или названию.

### ClientsDao

DAO (Data Access Object) для прямой работы с таблицей клиентов в БД:

Функциональность: Предоставляет низкоуровневый доступ к данным таблицы
Ключевые методы:
- **getActiveClients()**: Получение неудаленных клиентов
- **watchActiveClients()**: Отслеживание изменений в таблице
- **insertClient()**: Добавление новой записи
- **updateClient()**: Обновление записи
- **softDeleteClient()**: Мягкое удаление (установка метки времени)
- **searchByName()**: Поиск по строке в имени клиента

## Модели данных

### ClientsItem (модель таблицы)

Представляет структуру таблицы клиентов в БД:

id: Первичный ключ (автоинкремент)
type: Тип клиента (строковое значение)
name: Имя/наименование клиента
contactInfo: Контактная информация
additionalInfo: Дополнительная информация (опционально)
deletedAt: Метка времени удаления для реализации мягкого удаления

### Client (бизнес-модель)

Представляет клиента в бизнес-логике приложения:

id: Уникальный идентификатор
type: Тип клиента (перечисление ClientType)
name: Имя/наименование
contactInfo: Контактная информация
additionalInfo: Дополнительная информация (опционально)

### ClientType (перечисление)

Определяет возможные типы клиентов:

physical: Физическое лицо
legal: Юридическое лицо
individualEntrepreneur: Индивидуальный предприниматель
other: Другой тип
Дополнено вспомогательными методами для работы с отображаемыми названиями и преобразованиями строк.

### ClientData (`@freezed`, пример)

Модель данных, специфичная для клиента (если нужна)

### ClientModelComposite (бизнес-модель)

Представляет клиента в бизнес-логике приложения. Реализует IEntity (или IClientEntity).

## Основные операции

Отображение списка клиентов
Реализация: Использует StreamBuilder и watchClients() для реактивного обновления UI
Особенности: Обрабатывает различные состояния потока (загрузка, ошибка, пустой список)
UI: Отображает список с возможностью взаимодействия (редактирование, удаление)
Добавление/редактирование клиента
Реализация: Диалоговое окно с формой для ввода данных
Поля формы: Имя/название, тип клиента, контактная информация, дополнительная информация
Валидация: Проверка обязательных полей перед сохранением
Поведение: Адаптируется для режимов создания и редактирования

## UI компоненты

### ClientsScreen

Основной экран управления клиентами:

Функциональность: Отображение, поиск, добавление, редактирование, удаление клиентов
Особенности:
Использование StreamBuilder для реактивного UI
Поиск с дебаунсингом для оптимизации запросов
Адаптивный интерфейс для разных размеров экрана

### ClientListItem

Виджет для отображения одного клиента в списке:

Функциональность: Отображает основную информацию о клиенте
Особенности:
Разные иконки для разных типов клиентов
Поддержка свайпа для удаления с подтверждением
Интерактивность для перехода к редактированию

### DialogComponents

Элементы диалоговых окон для работы с данными клиентов:

ClientFormDialog: Форма с валидацией для создания и редактирования
ClientDeleteConfirmation: Диалог подтверждения удаления
ClientTypeSelector: Выбор типа клиента с визуальным форматированием