# Part Catalog - Инструкции для GitHub Copilot

> Это автоматически сгенерированный файл из документации проекта. Не редактируйте его напрямую.

## Содержание

1. [Основной обзор проекта и навигация по документации](#основной-обзор-проекта-и-навигация-по-документации)
2. [Общая архитектура приложения](#общая-архитектура-приложения)
3. [Руководство по стилю кодирования](#руководство-по-стилю-кодирования)
4. [Модуль клиентов](#модуль-клиентов)
5. [Модуль поставщиков запчастей](#модуль-поставщиков-запчастей)
6. [Структура БД и маппинги](#структура-бд-и-маппинги)
7. [Стратегия и паттерны тестирования](#стратегия-и-паттерны-тестирования)
8. [Модуль автомобилей](#модуль-автомобилей)
9. [Интеграция с внешними API](#интеграция-с-внешними-api)
10. [Стратегия обработки ошибок](#стратегия-обработки-ошибок)
11. [Модуль заказ-нарядов](#модуль-заказ-нарядов)
12. [Работа с асинхронным кодом](#работа-с-асинхронным-кодом)
13. [Прямое подключение к API](#прямое-подключение-к-api)
14. [Прокси-сервер для API поставщиков](#прокси-сервер-для-api-поставщиков)
15. [Справочник по API проекта](#справочник-по-api-проекта)

---

<!-- Source: docs\README.md -->
## Основной обзор проекта и навигация по документации

# Part Catalog

> Система управления учетом клиентов, автомобилей и заказ-нарядов для СТО

###### Содержание

- [Обзор](#обзор)
- [Архитектура](#архитектура)
- [Модули](#модули)
- [Руководства](#руководства)
- [Справочные материалы](#справочные-материалы)

###### Обзор

Part Catalog - это приложение для работников станций технического обслуживания автомобилей (СТО), обеспечивающее полный цикл учета клиентов, автомобилей, заказ-нарядов и запчастей.

**Ключевые возможности:**

- Учет клиентов (физических и юридических лиц)
- Учет автомобилей клиентов
- Управление заказ-нарядами
- Интеграция с каталогами запчастей
- Получение цен на запчасти от поставщиков

###### Архитектура

Документация по архитектуре приложения:

- [Общая архитектура](#overview) - обзор архитектуры приложения, слоев и компонентов
- [Структура БД](#database_schema) - схема БД, таблицы, связи и маппинги моделей
- [API интеграции](#api_integration) - интеграция с внешними API поставщиков и каталогов

###### Модули

Основные модули приложения:

- [Клиенты](#clients) - управление клиентами
- [Автомобили](#vehicles) - управление автомобилями клиентов
- [Заказ-наряды](#orders) - управление заказ-нарядами
- Поставщики:
  - [Обзор модуля](#overview) - общая информация о модуле
  - [Прямое подключение к API](#direct_api) - прямое взаимодействие с API поставщиков
  - [Прокси-сервер](#proxy_server) - использование прокси-сервера для запросов к API

###### Руководства

- [Стиль кодирования](#code_style) - соглашения по именованию, структуре файлов и организации кода
- [Тестирование](#testing) - стратегия и паттерны тестирования
- [Обработка ошибок](#error_handling) - подход к обработке ошибок и исключений
- [Асинхронное программирование](#async_programming) - работа с асинхронным кодом

###### Справочные материалы

- [API Reference](#api_reference) - справочник по API проекта
- [Примеры кода](#code_examples) - полные примеры кода

---

<!-- Source: docs\architecture\overview.md -->
## Общая архитектура приложения

---

<!-- Source: docs\guides\code_style.md -->
## Руководство по стилю кодирования

---

<!-- Source: docs\modules\clients.md -->
## Модуль клиентов

---

<!-- Source: docs\modules\suppliers\overview.md -->
## Модуль поставщиков запчастей

> Этот модуль отвечает за интеграцию с API поставщиков запчастей для получения информации о ценах и сроках доставки.

###### Содержание

- [Назначение](#назначение)
- [Архитектура](#архитектура)
- [Ключевые компоненты](#ключевые-компоненты)
- [Режимы работы](#режимы-работы)
- [Интеграция с прокси-сервером](#интеграция-с-прокси-сервером)

###### Назначение

Модуль поставщиков решает следующие задачи:

- Получение актуальных цен на запчасти от разных поставщиков
- Поиск запчастей по артикулу у разных поставщиков
- Получение информации о сроках доставки
- Агрегация данных от разных поставщиков в единый формат

###### Архитектура

Модуль построен на принципах **Чистой архитектуры** с четким разделением на уровни:

| Уровень | Назначение | Компоненты |
|---------|------------|------------|
| Presentation | Отображение данных | `SupplierScreen`, `PriceListWidget` |
| Domain | Бизнес-логика | `SuppliersService`, `SupplierRepository` |
| Data | Источники данных | `SupplierApiClient`, `LocalCacheManager` |

###### Диаграмма компонентов

###### Диаграмма компонентов

```
┌───────────────┐       ┌──────────────────┐      ┌─────────────────┐
│ ApiConnection │       │                  │      │                 │
│     Mode      │────>  │ ApiClientManager │────> │SupplierApiClient│
└───────────────┘       └──────────────────┘      └─────────────────┘
                                │                          │
                                │                          │
                                ▼                          │
                        ┌───────────────┐                  │
                        │ LocalStorage  │ <────────────────┘
                        │   Manager     │
                        └───────────────┘
```

###### Ключевые компоненты

###### SupplierApiClient

Базовый интерфейс для всех клиентов API поставщиков:

```dart
abstract class SupplierApiClient {
  Future<List<PartPriceModel>> getPricesByArticle(String article);
  Future<List<PartInfoModel>> searchPartsByName(String name);
  Future<PartDetailModel?> getPartDetails(String articleNumber);
}
```

###### SuppliersService

Сервис для работы с API поставщиков:

```dart
class SuppliersService {
  final Map<String, SupplierApiClient> _clients;

  SuppliersService(this._clients);

  Future<Map<String, List<PartPriceModel>>> getAllPricesByArticle(String article) async {
    // Реализация
  }
  
  Future<List<PartPriceModel>> getBestPricesByArticle(String article) async {
    // Реализация
  }
}
```

###### Режимы работы

Модуль поддерживает 3 режима работы с API поставщиков:

|   Режим   |   Описание                    |	Применение  |
|-----------|-------------------------------|---------------|
| Direct    | Прямое подключение к API      | Автономная работа, разработка, тестирование, локальная разработка    |
| Proxy     | Через прокси-сервер           | Продакшен, ограничения безопасности, платные API    |
|   Hybrid |	Автоматическое переключение |   Повышенная отказоустойчивость           |

**Подробнее о каждом режиме:**

    *   Прямое подключение к API
    *   Использование прокси-сервера
    *   Автоматическое переключение между режимами

###### Интеграция с прокси-сервером

Для перехода на работу через прокси-сервер необходима минимальная модификация кода клиента:

    1. Настройка режима работы в AppConfig
    2. Использование ApiClientManager для создания подходящих клиентов API
    3. Настройка адреса прокси-сервера

Подробнее см. [Реализация прокси-сервера](#proxy_server).


---

<!-- Source: docs\architecture\database_schema.md -->
## Структура БД и маппинги

---

<!-- Source: docs\guides\testing.md -->
## Стратегия и паттерны тестирования

---

<!-- Source: docs\modules\vehicles.md -->
## Модуль автомобилей

---

<!-- Source: docs\architecture\api_integration.md -->
## Интеграция с внешними API

---

<!-- Source: docs\guides\error_handling.md -->
## Стратегия обработки ошибок

---

<!-- Source: docs\modules\orders.md -->
## Модуль заказ-нарядов

---

<!-- Source: docs\guides\async_programming.md -->
## Работа с асинхронным кодом

---

<!-- Source: docs\modules\suppliers\direct_api.md -->
## Прямое подключение к API

---

<!-- Source: docs\modules\suppliers\proxy_server.md -->
## Прокси-сервер для API поставщиков

> Прокси-сервер позволяет централизовать доступ к API поставщиков запчастей, обеспечивая безопасное хранение API-ключей, кэширование результатов и оптимизацию платных запросов.

###### Содержание

- Назначение
- Архитектура
- Ключевые компоненты
- Установка и запуск
- Интеграция с клиентом

###### Назначение

Прокси-сервер решает следующие задачи:

- Централизованное хранение API-ключей поставщиков
- Обеспечение доступа к API с фиксированных IP-адресов
- Кэширование результатов для оптимизации платных запросов
- Унификация формата данных от разных поставщиков
- Мониторинг и логирование запросов

###### Архитектура

Прокси-сервер разработан на Dart с использованием пакета `shelf` и переиспользует код клиентской части для работы с API поставщиков.

###### Технический стек

- **Язык**: Dart
- **Фреймворк**: shelf
- **Хранение кэша**: sembast
- **Логирование**: logging

###### Общая схема работы

```
┌──────────────┐      HTTP      ┌──────────────┐      HTTP       ┌─────────────┐
│    Клиент    │   запрос 1 ─▶  │ Прокси-сервер│   запрос     ─▶│   API       │
│  (Flutter)   │                │ (Dart)        │                │ Поставщика  │
└──────────────┘  ◀──────────   └──────────────┘  ◀──────────   └─────────────┘
                       ответ                      ответ
         │
         ▼
    ┌───────────────┐
    │      Кэш      │
    │(sembast/redis)│
    └───────────────┘
```

###### Ключевые компоненты

###### Основные компоненты сервера

- **Router**: маршрутизация HTTP-запросов
- **ApiClientManager**: управление клиентами API поставщиков
- **CacheManager**: кэширование результатов запросов

###### Основные эндпоинты API

| Метод | Путь | Описание |
|-------|------|----------|
| GET | `/api/suppliers/{supplier}/prices` | Получение цен от конкретного поставщика |
| GET | `/api/suppliers/{supplier}/search` | Поиск запчастей у конкретного поставщика |
| GET | `/api/prices` | Агрегация цен от всех поставщиков |
| GET | `/health` | Проверка работоспособности сервера |

###### Установка и запуск

###### Предварительные требования

- Dart SDK 2.17.0 или выше
- Настроенные переменные окружения с API-ключами поставщиков

###### Команда запуска

```bash
# Запуск с параметрами по умолчанию
dart bin/server.dart

# Запуск с указанием порта
dart bin/server.dart --port=8080
```

###### Интеграция с клиентом

Для подключения клиента Flutter к прокси-серверу:

Настройка режима API в конфигурации:

```dart
// Изменение режима API на proxy
await apiClientManager.switchMode(ApiConnectionMode.proxy);
```

Указание URL прокси-сервера:

```dart
// Сохранение URL прокси-сервера
final prefs = await SharedPreferences.getInstance();
await prefs.setString('proxy_server_url', 'https://your-proxy-server.com');
```



---

<!-- Source: docs\references\api_reference.md -->
## Справочник по API проекта

---


## Примеры кода

> Ниже приведены наиболее важные примеры кода из проекта

### api_client.dart

```dart
//# Полный пример API клиента

```

### proxy_server.dart

```dart
//# Полный пример прокси-сервера

```

